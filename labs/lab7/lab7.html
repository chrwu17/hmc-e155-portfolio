<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.22">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Christian Wu">
<meta name="dcterms.date" content="2025-10-26">

<title>Lab 7: The Advanced Encryption Standard (AES) – E155 Portfolio</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-cd7454b418030687c631a6a7286fbe16.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-5b4ad623e5705c0698d39aec6f10cf02.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">E155 Portfolio</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-labs" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Labs</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-labs">    
        <li>
    <a class="dropdown-item" href="../../labs/overview.html">
 <span class="dropdown-text">Overview</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../labs/lab1/lab1.html">
 <span class="dropdown-text">Lab 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../labs/lab2/lab2.html">
 <span class="dropdown-text">Lab 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../labs/lab3/lab3.html">
 <span class="dropdown-text">Lab 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../labs/lab4/lab4.html">
 <span class="dropdown-text">Lab 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../labs/lab5/lab5.html">
 <span class="dropdown-text">Lab 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../labs/lab6/lab6.html">
 <span class="dropdown-text">Lab 6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../labs/lab7/lab7.html">
 <span class="dropdown-text">Lab 7</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-final-project" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Final Project</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-final-project">    
        <li>
    <a class="dropdown-item" href="../../finalProject/proposal/proposal.html">
 <span class="dropdown-text">Project Proposal</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../resources.html"> 
<span class="menu-text">Resources</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#mcu-design" id="toc-mcu-design" class="nav-link" data-scroll-target="#mcu-design">MCU Design</a></li>
  <li><a href="#fpga-design" id="toc-fpga-design" class="nav-link" data-scroll-target="#fpga-design">FPGA Design</a>
  <ul class="collapse">
  <li><a href="#objective" id="toc-objective" class="nav-link" data-scroll-target="#objective">Objective</a></li>
  <li><a href="#design" id="toc-design" class="nav-link" data-scroll-target="#design">Design</a></li>
  <li><a href="#testbench-simulation-and-testing" id="toc-testbench-simulation-and-testing" class="nav-link" data-scroll-target="#testbench-simulation-and-testing">Testbench Simulation and Testing</a></li>
  <li><a href="#hardware" id="toc-hardware" class="nav-link" data-scroll-target="#hardware">Hardware</a></li>
  </ul></li>
  <li><a href="#ai-prototype" id="toc-ai-prototype" class="nav-link" data-scroll-target="#ai-prototype">AI Prototype</a>
  <ul class="collapse">
  <li><a href="#prompt-1" id="toc-prompt-1" class="nav-link" data-scroll-target="#prompt-1">Prompt 1</a></li>
  <li><a href="#modular-prompts" id="toc-modular-prompts" class="nav-link" data-scroll-target="#modular-prompts">Modular Prompts</a></li>
  <li><a href="#reflection" id="toc-reflection" class="nav-link" data-scroll-target="#reflection">Reflection</a></li>
  </ul></li>
  <li><a href="#hours-spent" id="toc-hours-spent" class="nav-link" data-scroll-target="#hours-spent">Hours Spent</a></li>
  </ul>
<div class="quarto-other-links"><h2>Other Links</h2><ul><li><a href="https://hmc-e155.github.io/lab/lab7/"><i class="bi bi-link-45deg"></i>E155 Course Website: Lab 7</a></li></ul></div><div class="quarto-code-links"><h2>Code Links</h2><ul><li><a href="https://github.com/chrwu17/e155-lab7"><i class="bi bi-github"></i>Lab 7 Github Repo</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Lab 7: The Advanced Encryption Standard (AES)</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Christian Wu </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 26, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>The goal of this lab is to use our FPGA as a hardware accelerator to perform AES-128 encryption with plaintext and key provided by our MCU.</p>
</section>
<section id="mcu-design" class="level2">
<h2 class="anchored" data-anchor-id="mcu-design">MCU Design</h2>
<p>All of the MCU Code was provided for this lab from the <a href="https://github.com/HMC-E155/hmc-e155//tree/main/lab/lab07">E155 Lab 7 Starter Code Repository</a>. Thus, the work done for this lab was for building the FPGA hardware accelerator below.</p>
</section>
<section id="fpga-design" class="level2">
<h2 class="anchored" data-anchor-id="fpga-design">FPGA Design</h2>
<section id="objective" class="level3">
<h3 class="anchored" data-anchor-id="objective">Objective</h3>
<p>The objective of this lab is to use SPI to send a plaintext and key from our MCU to our FPGA, use our FPGA as a hardware accelerator to do AES-128 encryption, and then send the encrypted ciphertext back to the MCU via SPI.</p>
</section>
<section id="design" class="level3">
<h3 class="anchored" data-anchor-id="design">Design</h3>
<section id="aes-encryption" class="level4">
<h4 class="anchored" data-anchor-id="aes-encryption">AES Encryption</h4>
<p>The encryption method we are using is AES-128 according to the <a href="https://hmc-e155.github.io/assets/doc/NIST.FIPS.197-upd1.pdf">NIST FIPS-197 specification</a>. For this lab, I will be creating it by following the following pseudocode:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/cipher_pseudo.png" class="img-fluid figure-img"></p>
<figcaption>FIPS-197 Encryption Pseudocode</figcaption>
</figure>
</div>
<p>For the key expansion module, I will be following the pseudocode below:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/keyExpansion_pseudo.png" class="img-fluid figure-img"></p>
<figcaption>FIPS-197 keyExpansion Pseudocode</figcaption>
</figure>
</div>
<p>The logic for each of the modules that I write can be found in the NIST FIPS-197 documentation.</p>
</section>
<section id="block-diagram" class="level4">
<h4 class="anchored" data-anchor-id="block-diagram">Block Diagram</h4>
<p>My approach for this lab was to have a module for each of the sections of the NIST FIPS-197 documentation. The top level <code>aes.sv</code> module uses the onboard HSOSC 48 MHz clock and receives the key and plaintext via SPI from the MCU and then does the encryption. Then it sends the encrypted ciphertext back to the MCU via SPI. Belows is my block diagram for this lab:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/blockDiagram.png" class="img-fluid figure-img"></p>
<figcaption>Lab 7 Block Diagram</figcaption>
</figure>
</div>
</section>
<section id="aes-core-fsm" class="level4">
<h4 class="anchored" data-anchor-id="aes-core-fsm">AES Core FSM</h4>
<section id="fsm-overview" class="level5">
<h5 class="anchored" data-anchor-id="fsm-overview">FSM Overview</h5>
<p>The AES core FSM was designed with 9 states (S0-S8) to implement the AES-128 encryption algorithm according to FIPS-197. The FSM orchestrates the encryption process through an initial round, 9 regular rounds, and a final round, accounting for the pipeline delays introduced by synchronous S-box lookups.</p>
<section id="design-rationale" class="level6">
<h6 class="anchored" data-anchor-id="design-rationale">Design Rationale</h6>
<p>The state machine accounts for <strong>pipeline delays</strong> from synchronous operations: - <strong>SubBytes delay</strong>: 1 cycle (sbox_sync uses block RAM) - <strong>KeyExpansion delay</strong>: 2 cycles total (1 for subWord sbox, 1 for final register)</p>
<p>These delays necessitate wait states between operations to ensure data is ready before proceeding. The design prioritizes correctness and synchronization over speed, completing full AES-128 encryption in <strong>11 clock cycles</strong> (including the load cycle).</p>
</section>
<section id="state-utilization" class="level6">
<h6 class="anchored" data-anchor-id="state-utilization">State Utilization</h6>
<p>Currently using <strong>4 bits</strong> of state representation for <strong>9 states</strong>, leaving <strong>7 unused states</strong>. This is acceptable because: - Clear state encoding improves debuggability - Minimal hardware cost for extra flip-flops - Could potentially optimize to 3 bits (since 2³ = 8 &lt; 9 &lt; 16 = 2⁴), but would need special handling</p>
</section>
</section>
<section id="fsm-state-transition-diagram" class="level5">
<h5 class="anchored" data-anchor-id="fsm-state-transition-diagram">FSM State Transition Diagram</h5>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/fsm.png" class="img-fluid figure-img"></p>
<figcaption><code>aes_core</code> FSM State Transition Diagram</figcaption>
</figure>
</div>
</section>
<section id="state-transition-table" class="level5">
<h5 class="anchored" data-anchor-id="state-transition-table">State Transition Table</h5>
<table class="caption-top table">
<colgroup>
<col style="width: 29%">
<col style="width: 21%">
<col style="width: 23%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Current State</th>
<th>Condition</th>
<th>Next State</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>S0</strong></td>
<td>Always</td>
<td><strong>S1</strong></td>
<td>Initial AddRoundKey complete, SubBytes starts</td>
</tr>
<tr class="even">
<td><strong>S1</strong></td>
<td>Always</td>
<td><strong>S2</strong></td>
<td>Wait 1 cycle for SubBytes (sbox_sync)</td>
</tr>
<tr class="odd">
<td><strong>S2</strong></td>
<td>Always</td>
<td><strong>S3</strong></td>
<td>Wait 1 cycle for KeyExpansion (subWord sbox)</td>
</tr>
<tr class="even">
<td><strong>S3</strong></td>
<td>Always</td>
<td><strong>S4</strong></td>
<td>Wait 1 cycle for key register</td>
</tr>
<tr class="odd">
<td><strong>S4</strong></td>
<td><code>round &lt; 9</code></td>
<td><strong>S1</strong></td>
<td>Continue to next regular round (rounds 1-9)</td>
</tr>
<tr class="even">
<td><strong>S4</strong></td>
<td><code>round == 9</code></td>
<td><strong>S5</strong></td>
<td>Move to final round (round 10)</td>
</tr>
<tr class="odd">
<td><strong>S5</strong></td>
<td>Always</td>
<td><strong>S6</strong></td>
<td>Final SubBytes starts</td>
</tr>
<tr class="even">
<td><strong>S6</strong></td>
<td>Always</td>
<td><strong>S7</strong></td>
<td>Wait for final key expansion</td>
</tr>
<tr class="odd">
<td><strong>S7</strong></td>
<td>Always</td>
<td><strong>S8</strong></td>
<td>Final AddRoundKey complete</td>
</tr>
<tr class="even">
<td><strong>S8</strong></td>
<td>Always</td>
<td><strong>S8</strong></td>
<td>Stay in done state</td>
</tr>
</tbody>
</table>
</section>
<section id="output-control-tables" class="level5">
<h5 class="anchored" data-anchor-id="output-control-tables">Output Control Tables</h5>
<section id="state-actions" class="level6">
<h6 class="anchored" data-anchor-id="state-actions">State Actions</h6>
<table class="caption-top table">
<colgroup>
<col style="width: 30%">
<col style="width: 39%">
<col style="width: 30%">
</colgroup>
<thead>
<tr class="header">
<th>State</th>
<th>Actions</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>S0</strong></td>
<td><code>currentState &lt;= addRoundKeyDone</code></td>
<td>Capture initial AddRoundKey result</td>
</tr>
<tr class="even">
<td><strong>S1</strong></td>
<td>(none)</td>
<td>Wait for SubBytes pipeline</td>
</tr>
<tr class="odd">
<td><strong>S2</strong></td>
<td>(none)</td>
<td>Wait for KeyExpansion pipeline</td>
</tr>
<tr class="even">
<td><strong>S3</strong></td>
<td>(none)</td>
<td>Wait for key register pipeline</td>
</tr>
<tr class="odd">
<td><strong>S4</strong></td>
<td><code>currentKey &lt;= keyExpansionDone</code><br><code>currentState &lt;= addRoundKeyDone</code><br><code>if (round == 9) savedFinalKey &lt;= keyExpansionDone</code><br><code>if (round &lt; 9) round++</code></td>
<td>Capture expanded key and state<br>Save round-10 key when finishing round 9<br>Increment round counter</td>
</tr>
<tr class="even">
<td><strong>S5</strong></td>
<td><code>finalLeftReg &lt;= shiftRowsDone</code></td>
<td>Save ShiftRows output (skip MixColumns)</td>
</tr>
<tr class="odd">
<td><strong>S6</strong></td>
<td>(none)</td>
<td>Wait for final key expansion</td>
</tr>
<tr class="even">
<td><strong>S7</strong></td>
<td><code>currentState &lt;= addRoundKeyDone</code></td>
<td>Final AddRoundKey result</td>
</tr>
<tr class="odd">
<td><strong>S8</strong></td>
<td><code>done &lt;= 1</code></td>
<td>Assert done signal</td>
</tr>
</tbody>
</table>
</section>
<section id="datapath-multiplexer-controls" class="level6">
<h6 class="anchored" data-anchor-id="datapath-multiplexer-controls">Datapath Multiplexer Controls</h6>
<p><strong>bypassMuxResult (input to AddRoundKey)</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>State</th>
<th>Mux Output</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>S0</strong></td>
<td><code>plainTextState</code></td>
<td>Initial round uses plaintext</td>
</tr>
<tr class="even">
<td><strong>S4</strong></td>
<td><code>mixColumnsDone</code></td>
<td>Regular rounds include MixColumns</td>
</tr>
<tr class="odd">
<td><strong>S7</strong></td>
<td><code>finalLeftReg</code></td>
<td>Final round skips MixColumns</td>
</tr>
<tr class="even">
<td>Other</td>
<td><code>currentState</code></td>
<td>Default (maintain state)</td>
</tr>
</tbody>
</table>
<p><strong>keyMuxOut (key input to AddRoundKey)</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>State</th>
<th>Mux Output</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>S0</strong></td>
<td><code>initialKeyState</code></td>
<td>Use original cipher key</td>
</tr>
<tr class="even">
<td><strong>S7</strong></td>
<td><code>finalKeyState</code></td>
<td>Use saved round-10 key</td>
</tr>
<tr class="odd">
<td>Other</td>
<td><code>keyState</code></td>
<td>Use current expanded key</td>
</tr>
</tbody>
</table>
</section>
</section>
</section>
</section>
<section id="testbench-simulation-and-testing" class="level3">
<h3 class="anchored" data-anchor-id="testbench-simulation-and-testing">Testbench Simulation and Testing</h3>
<section id="testbench-design-and-results" class="level4">
<h4 class="anchored" data-anchor-id="testbench-design-and-results">Testbench Design and Results</h4>
<p>To test my code and see whether it would work as expected, I created a testbench to test before moving on to using physical hardware. I created a testbench for each of my modules, testing a different functionality of this lab with east testbench. Due to the large number of modules that I have in this lab, I am not posting the code in this writeup, but each testbench can be found in my <a href="https://github.com/chrwu17/e155-lab7/tree/main/fpga/sim">Lab 7 Github Repo</a>.</p>
<p>Each of the testbenches were done by using the stim/assert method or checking if the outputs match the expected value, to ensure functionality automatically, without having to analyze the waveforms carefully to see if it worked or not.</p>
<section id="addroundkey_tb-results" class="level5">
<h5 class="anchored" data-anchor-id="addroundkey_tb-results"><code>addRoundKey_tb</code> results:</h5>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/addRoundKey_waveforms.png" class="img-fluid figure-img"></p>
<figcaption><code>addRoundKey</code> Waveforms</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/addRoundKey_transcript.png" class="img-fluid figure-img"></p>
<figcaption><code>addRoundKey</code> Transcript</figcaption>
</figure>
</div>
</section>
<section id="aes_core_tb-results" class="level5">
<h5 class="anchored" data-anchor-id="aes_core_tb-results"><code>aes_core_tb</code> results:</h5>
<p>This testbench tests if encryption works correctly.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/aes_core_waveforms.png" class="img-fluid figure-img"></p>
<figcaption><code>aes_core</code> Waveforms</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/aes_core_transcript.png" class="img-fluid figure-img"></p>
<figcaption><code>aes_core</code> Transcript</figcaption>
</figure>
</div>
</section>
<section id="aes_sbox_tb-results" class="level5">
<h5 class="anchored" data-anchor-id="aes_sbox_tb-results"><code>aes_sbox_tb</code> results:</h5>
<p>This testbench demonstrates 1-cycle latency of RAM blocks doing s-box substitution</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/aes_sbox_waveforms.png" class="img-fluid figure-img"></p>
<figcaption><code>aes_sbox_tb</code> Waveforms</figcaption>
</figure>
</div>
</section>
<section id="aes_spi-results" class="level5">
<h5 class="anchored" data-anchor-id="aes_spi-results"><code>aes_spi</code> results:</h5>
<p>This testbench tests encryption with SPI functionality.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/aes_spi_waveforms.png" class="img-fluid figure-img"></p>
<figcaption><code>aes_spi</code> Waveforms</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/aes_spi_transcript.png" class="img-fluid figure-img"></p>
<figcaption><code>aes_spi</code> Transcript</figcaption>
</figure>
</div>
</section>
<section id="galoismult_tb-results" class="level5">
<h5 class="anchored" data-anchor-id="galoismult_tb-results"><code>galoismult_tb</code> results:</h5>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/galoismult_waveforms.png" class="img-fluid figure-img"></p>
<figcaption><code>galoismult</code> Waveforms</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/galoismult_transcript.png" class="img-fluid figure-img"></p>
<figcaption><code>galoismult</code> Transcript</figcaption>
</figure>
</div>
</section>
<section id="input2state_tb-results" class="level5">
<h5 class="anchored" data-anchor-id="input2state_tb-results"><code>input2State_tb</code> results:</h5>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/input2State_waveforms.png" class="img-fluid figure-img"></p>
<figcaption><code>input2State</code> Waveforms</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/input2State_transcript.png" class="img-fluid figure-img"></p>
<figcaption><code>input2State</code> Transcript</figcaption>
</figure>
</div>
</section>
<section id="keyexpansion_tb-results" class="level5">
<h5 class="anchored" data-anchor-id="keyexpansion_tb-results"><code>keyExpansion_tb</code> results:</h5>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/keyExpansion_waveforms.png" class="img-fluid figure-img"></p>
<figcaption><code>keyExpansion</code> Waveforms</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/keyExpansion_transcript.png" class="img-fluid figure-img"></p>
<figcaption><code>keyExpansion</code> Transcript</figcaption>
</figure>
</div>
</section>
<section id="mixcolumn_tb-results" class="level5">
<h5 class="anchored" data-anchor-id="mixcolumn_tb-results"><code>mixcolumn_tb</code> results:</h5>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/mixColumn_waveforms.png" class="img-fluid figure-img"></p>
<figcaption><code>mixcolumn</code> Waveforms</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/mixColumn_transcript.png" class="img-fluid figure-img"></p>
<figcaption><code>mixcolumn</code> Transcript</figcaption>
</figure>
</div>
</section>
<section id="mixcolumns_tb-results" class="level5">
<h5 class="anchored" data-anchor-id="mixcolumns_tb-results"><code>mixcolumns_tb</code> results:</h5>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/mixColumns_waveforms.png" class="img-fluid figure-img"></p>
<figcaption><code>mixcolumns</code> Waveforms</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/mixColumns_transcript.png" class="img-fluid figure-img"></p>
<figcaption><code>mixcolumns</code> Transcript</figcaption>
</figure>
</div>
</section>
<section id="rotword_tb-results" class="level5">
<h5 class="anchored" data-anchor-id="rotword_tb-results"><code>rotWord_tb</code> results:</h5>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/rotWord_waveforms.png" class="img-fluid figure-img"></p>
<figcaption><code>rotWord_tb</code> Waveforms</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/rotWord_transcript.png" class="img-fluid figure-img"></p>
<figcaption><code>rotWord_tb</code> Transcript</figcaption>
</figure>
</div>
</section>
<section id="sbox_tb-results" class="level5">
<h5 class="anchored" data-anchor-id="sbox_tb-results"><code>sbox_tb</code> results:</h5>
<p>This testbench tests the non synchronized sbox module</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/sbox_waveforms.png" class="img-fluid figure-img"></p>
<figcaption><code>sbox</code> Waveforms</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/sbox_transcript.png" class="img-fluid figure-img"></p>
<figcaption><code>sbox</code> Transcript</figcaption>
</figure>
</div>
</section>
<section id="shiftrows_tb-results" class="level5">
<h5 class="anchored" data-anchor-id="shiftrows_tb-results"><code>shiftRows_tb</code> results:</h5>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/shiftRows_waveforms.png" class="img-fluid figure-img"></p>
<figcaption><code>shiftRows</code> Waveforms</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/shiftRows_transcript.png" class="img-fluid figure-img"></p>
<figcaption><code>shiftRows</code> Transcript</figcaption>
</figure>
</div>
</section>
<section id="state2output_tb-results" class="level5">
<h5 class="anchored" data-anchor-id="state2output_tb-results"><code>state2Output_tb</code> results:</h5>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/state2Output_waveforms.png" class="img-fluid figure-img"></p>
<figcaption><code>state2Output</code> Waveforms</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/state2Output_transcript.png" class="img-fluid figure-img"></p>
<figcaption><code>state2Output</code> Transcript</figcaption>
</figure>
</div>
</section>
<section id="subbytes_tb-results" class="level5">
<h5 class="anchored" data-anchor-id="subbytes_tb-results"><code>subBytes_tb</code> results:</h5>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/subBytes_waveforms.png" class="img-fluid figure-img"></p>
<figcaption><code>subBytes</code> Waveforms</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/subBytes_transcript.png" class="img-fluid figure-img"></p>
<figcaption><code>subBytes</code> Transcript</figcaption>
</figure>
</div>
</section>
<section id="subword_tb-results" class="level5">
<h5 class="anchored" data-anchor-id="subword_tb-results"><code>subWord_tb</code> results:</h5>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/subWord_waveforms.png" class="img-fluid figure-img"></p>
<figcaption><code>subWord</code> Waveforms</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/subWord_transcript.png" class="img-fluid figure-img"></p>
<figcaption><code>subWord</code> Transcript</figcaption>
</figure>
</div>
<p>Thus, all testbenches and testing for this lab was successful!</p>
</section>
</section>
</section>
<section id="hardware" class="level3">
<h3 class="anchored" data-anchor-id="hardware">Hardware</h3>
<section id="design-and-schematic" class="level4">
<h4 class="anchored" data-anchor-id="design-and-schematic">Design and Schematic</h4>
<p>After finishing with testing, I can now build my hardware and program my FPGA and MCU. Our E155 Development board has onboard SPI connections for SPI between the FPGA and MCU, so we do not need to use any breadboarding. Thus, a schematic is not necessary. Below are all the pins we are using.</p>
<table class="caption-top table">
<caption>Pin assignments for Lab 7 inputs and outputs</caption>
<thead>
<tr class="header">
<th>Name</th>
<th>MCU Pin</th>
<th>FPGA Pin</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>CE</td>
<td><code>PA11</code></td>
<td>—</td>
</tr>
<tr class="even">
<td>SCK</td>
<td><code>PB3</code></td>
<td><code>P21</code></td>
</tr>
<tr class="odd">
<td>CIPO</td>
<td><code>PB4</code></td>
<td><code>P12</code></td>
</tr>
<tr class="even">
<td>COPI</td>
<td><code>PB5</code></td>
<td><code>P10</code></td>
</tr>
<tr class="odd">
<td>LOAD</td>
<td><code>PA5</code></td>
<td><code>P26</code></td>
</tr>
<tr class="even">
<td>DONE</td>
<td><code>PA6</code></td>
<td><code>P27</code></td>
</tr>
<tr class="odd">
<td>SUCCESS_LED</td>
<td><code>PA9</code></td>
<td>—</td>
</tr>
<tr class="even">
<td>FAIL_LED</td>
<td><code>PA10</code></td>
<td>—</td>
</tr>
</tbody>
</table>
</section>
<section id="results" class="level4">
<h4 class="anchored" data-anchor-id="results">Results</h4>
<p>After finishing with the design, I was able to program my FPGA and MCU. I used a logic analyzer to confirm that the SPI transaction worked correctly.</p>
<p>Below is the Logic Analyzer SPI Transaction:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/la.png" class="img-fluid figure-img"></p>
<figcaption>Logic Analyzer SPI Transaction</figcaption>
</figure>
</div>
<p>Within my logic analyzer transaction, I can also confirm that I have the correct values for my plaintext, key, and ciphertext. Below are logic analyzer pictures for the first four values of each:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/pt1.png" class="img-fluid figure-img"></p>
<figcaption>First two values of Plaintext</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/pt2.png" class="img-fluid figure-img"></p>
<figcaption>Third and fourth values of Plaintext</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/key1.png" class="img-fluid figure-img"></p>
<figcaption>First two values of key</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/key2.png" class="img-fluid figure-img"></p>
<figcaption>Third and fourth values of key</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/ct1.png" class="img-fluid figure-img"></p>
<figcaption>First two values of ciphertext</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/ct2.png" class="img-fluid figure-img"></p>
<figcaption>Third and fourth values of ciphertext</figcaption>
</figure>
</div>
<p>As a result, my design and project has met all the requirements for this lab.</p>
</section>
</section>
</section>
<section id="ai-prototype" class="level2">
<h2 class="anchored" data-anchor-id="ai-prototype">AI Prototype</h2>
<section id="prompt-1" class="level3">
<h3 class="anchored" data-anchor-id="prompt-1">Prompt 1</h3>
<p>To test how AI would do for this lab, I entered the following prompt to ChatGPT:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>Write SystemVerilog HDL to implement the KeyExpansion logic described in the FIPS-197 uploaded document. The module should be purely combinational, using the previous key and current round number to calculate the next key. Assume other required modules (SubWord and RotWord) are already implemented.</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<section id="ai-code" class="level4">
<h4 class="anchored" data-anchor-id="ai-code">AI Code</h4>
<p>As a result, it returned the following code:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>// -----------------------------------------------------------------------------</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>// AES-128 KeyExpansion (next round key)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>// Combinational: next_key = KeyExpansion(prev_key, round_num)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>// References: FIPS-197 §5.2 KEYEXPANSION(), Alg.2; Table 5 (Rcon)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>// Assumptions:</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>//   - prev_key layout: {w0, w1, w2, w3} with w0 at <span class="co">[</span><span class="ot">127:96</span><span class="co">]</span> and w3 at <span class="co">[</span><span class="ot">31:0</span><span class="co">]</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>//   - Round numbers are 1..10 for AES-128.</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>//   - Modules RotWord and SubWord exist and are purely combinational:</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>//       module RotWord(input  logic <span class="co">[</span><span class="ot">31:0</span><span class="co">]</span> in, output logic <span class="co">[</span><span class="ot">31:0</span><span class="co">]</span> out);</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>//       module SubWord(input  logic <span class="co">[</span><span class="ot">31:0</span><span class="co">]</span> in, output logic <span class="co">[</span><span class="ot">31:0</span><span class="co">]</span> out);</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>// -----------------------------------------------------------------------------</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>module AesKeyExpansion128 (</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    input  logic <span class="co">[</span><span class="ot">127:0</span><span class="co">]</span> prev_key,     // previous round key (K_round)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    input  logic  <span class="co">[</span><span class="ot">3:0</span><span class="co">]</span>  round_num,    // 1..10</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    output logic <span class="co">[</span><span class="ot">127:0</span><span class="co">]</span> next_key      // next round key (K_round+1)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>);</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    // Split previous 128-bit key into 4 words</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    logic <span class="co">[</span><span class="ot">31:0</span><span class="co">]</span> w0, w1, w2, w3;</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    assign {w0, w1, w2, w3} = prev_key;</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="in">    // Temp = SubWord(RotWord(w3)) ^ Rcon[round_num]  (FIPS-197 §5.2)</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="in">    logic [31:0] rotw, subw, rcon, temp;</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="in">    RotWord u_rot (.in(w3), .out(rotw));</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="in">    SubWord u_sub (.in(rotw), .out(subw));</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="in">    // Round constants Rcon[j] = {rc,00,00,00} for j=1..10 (Table 5)</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="in">    function automatic logic [31:0] rcon_lut(input logic [3:0] j);</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="in">        unique case (j)</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="in">            4'd1:  rcon_lut = 32'h01_00_00_00;</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="in">            4'd2:  rcon_lut = 32'h02_00_00_00;</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="in">            4'd3:  rcon_lut = 32'h04_00_00_00;</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="in">            4'd4:  rcon_lut = 32'h08_00_00_00;</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a><span class="in">            4'd5:  rcon_lut = 32'h10_00_00_00;</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a><span class="in">            4'd6:  rcon_lut = 32'h20_00_00_00;</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a><span class="in">            4'd7:  rcon_lut = 32'h40_00_00_00;</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="in">            4'd8:  rcon_lut = 32'h80_00_00_00;</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a><span class="in">            4'd9:  rcon_lut = 32'h1B_00_00_00;</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="in">            4'd10: rcon_lut = 32'h36_00_00_00;</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a><span class="in">            default: rcon_lut = 32'h00_00_00_00; // safe default</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a><span class="in">        endcase</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a><span class="in">    endfunction</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a><span class="in">    assign rcon = rcon_lut(round_num);</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a><span class="in">    assign temp = subw ^ rcon;</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a><span class="in">    // Next words (AES-128):</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a><span class="in">    //  w4 = w0 ^ temp</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a><span class="in">    //  w5 = w1 ^ w4</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a><span class="in">    //  w6 = w2 ^ w5</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a><span class="in">    //  w7 = w3 ^ w6</span></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a><span class="in">    logic [31:0] nw0, nw1, nw2, nw3;</span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a><span class="in">    assign nw0 = w0 ^ temp;</span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a><span class="in">    assign nw1 = w1 ^ nw0;</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a><span class="in">    assign nw2 = w2 ^ nw1;</span></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a><span class="in">    assign nw3 = w3 ^ nw2;</span></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a><span class="in">    assign next_key = {nw0, nw1, nw2, nw3};</span></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>endmodule</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="test-in-questa" class="level4">
<h4 class="anchored" data-anchor-id="test-in-questa">Test in Questa</h4>
<p>I tried to fix the code and run my testbench, but I could not get the testbench to run as one of the inputs is the round number not the rcon value, and for my code, I have it so that my <code>aes_core</code> file calculates rcon based on the round number and feeds it into <code>keyEpxansion</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/ai1.png" class="img-fluid figure-img"></p>
<figcaption>Cannot run testbench on AI Result</figcaption>
</figure>
</div>
</section>
</section>
<section id="modular-prompts" class="level3">
<h3 class="anchored" data-anchor-id="modular-prompts">Modular Prompts</h3>
<p>I then ran the second prompt by the pseudocode. I used the following prompt:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="an">Write SystemVerilog HDL to implement the following logic:</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>i = 0</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>while i &lt; Nk do</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    w<span class="co">[</span><span class="ot">i</span><span class="co">]</span> &lt;- key<span class="co">[</span><span class="ot">4*i..4*i+3</span><span class="co">]</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    i &lt;- i+1</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>end while</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>while i &lt;= 4 * Nr + 3 do</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    temp &lt;- w<span class="co">[</span><span class="ot">i-1</span><span class="co">]</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    if i mod Nk = 0 then</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>        temp &lt;- module1(module2(temp)) (+) Rcon<span class="co">[</span><span class="ot">i/Nk</span><span class="co">]</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    else if Nk &gt; 6 and i mod Nk = 4 then</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>        temp &lt;- module1(temp)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    end if</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    w<span class="co">[</span><span class="ot">i</span><span class="co">]</span> &lt;- w<span class="co">[</span><span class="ot">i-Nk</span><span class="co">]</span> (+) temp</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    i &lt;- i + 1</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>end while</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>return w</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>Assume module1 and module2 are existing modules that can be instantiated. (+) refers to XOR. Unwrap the loop in the provided pseudo code so it uses the previous iterations output to generate the new iteration.</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>Do not use any existing knowledge of the AES specifications in your answer.</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<section id="ai-code-result" class="level4">
<h4 class="anchored" data-anchor-id="ai-code-result">AI Code Result</h4>
<p>ChatGPT gave me the following code.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>// ------------------------------------------------------------</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>// Key-like expansion (fully combinational, loop "unrolled")</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>// Mirrors the provided pseudo-code without using any AES spec.</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>//</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>// PSEUDO (for reference):</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>// i = 0</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>// while i &lt; Nk do</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>//   w<span class="co">[</span><span class="ot">i</span><span class="co">]</span> &lt;- key<span class="co">[</span><span class="ot">4*i..4*i+3</span><span class="co">]</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>//   i &lt;- i+1</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>// end while</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>// while i &lt;= 4 * Nr + 3 do</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>//   temp &lt;- w<span class="co">[</span><span class="ot">i-1</span><span class="co">]</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>//   if i mod Nk = 0 then</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>//       temp &lt;- module1(module2(temp)) (+) Rcon<span class="co">[</span><span class="ot">i/Nk</span><span class="co">]</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>//   else if Nk &gt; 6 and i mod Nk = 4 then</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>//       temp &lt;- module1(temp)</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>//   end if</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>//   w<span class="co">[</span><span class="ot">i</span><span class="co">]</span> &lt;- w<span class="co">[</span><span class="ot">i-Nk</span><span class="co">]</span> (+) temp</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>//   i &lt;- i + 1</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>// end while</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>// return w</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>// ------------------------------------------------------------</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>module keyExpansion #(</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    parameter int NK = 4,          // number of initial key words</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    parameter int NR = 10          // used to size total output words</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>) (</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    // Initial key as words: key_words<span class="co">[</span><span class="ot">i</span><span class="co">]</span> corresponds to key<span class="co">[</span><span class="ot">4*i .. 4*i+3</span><span class="co">]</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    input logic clk,</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>    input  logic <span class="co">[</span><span class="ot">31:0</span><span class="co">]</span> key_words <span class="co">[</span><span class="ot">0:NK-1</span><span class="co">]</span>,</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a><span class="in">    // Rcon array: only entries actually used are those at indices i/NK</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="in">    // for i in [NK .. (4*NR+3)], when (i % NK) == 0.</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a><span class="in">    // Size it to at least ( (4*NR+3) / NK ).</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a><span class="in">    input  logic [31:0] rcon      [0:((4*NR+3)/NK)],</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a><span class="in">    // Expanded words w[0 .. 4*NR+3]</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a><span class="in">    output logic [31:0] w         [0:(4*NR+3)]</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>);</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a><span class="in">    // Total number of output words</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a><span class="in">    localparam int WORDS = 4*NR + 4;</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a><span class="in">    // Internal wire array for the chain</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a><span class="in">    logic [31:0] w_int [0:WORDS-1];</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a><span class="in">    // ---- First segment: copy initial key words ----</span></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a><span class="in">    genvar k;</span></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a><span class="in">    generate</span></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a><span class="in">        for (k = 0; k &lt; NK; k++) begin : INIT</span></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a><span class="in">            // w[k] &lt;- key[4*k .. 4*k+3]</span></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a><span class="in">            assign w_int[k] = key_words[k];</span></span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a><span class="in">        end</span></span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a><span class="in">    endgenerate</span></span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a><span class="in">    // ---- Second segment: generate remaining words, unrolled ----</span></span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a><span class="in">    // For each i in [NK .. WORDS-1], compute per the pseudo-code.</span></span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a><span class="in">    genvar i;</span></span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a><span class="in">    generate</span></span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a><span class="in">        for (i = NK; i &lt; WORDS; i++) begin : EXPAND</span></span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a><span class="in">            // temp &lt;- w[i-1] (base)</span></span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a><span class="in">            wire [31:0] base_temp = w_int[i-1];</span></span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a><span class="in">            // Parallel evaluations needed for conditional paths:</span></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a><span class="in">            //   A) module1(module2(temp))</span></span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a><span class="in">            //   B) module1(temp)</span></span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a><span class="in">            // We build both and select by static conditions below.</span></span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a><span class="in">            wire [31:0] m2_out;</span></span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a><span class="in">            wire [31:0] m1_after_m2_out;</span></span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a><span class="in">            wire [31:0] m1_direct_out;</span></span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a><span class="in">            // Instantiate module2 for this step (input is base_temp)</span></span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a><span class="in">            rotWord u_m2 (</span></span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a><span class="in">                base_temp,</span></span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a><span class="in">                m2_out</span></span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a><span class="in">            );</span></span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a><span class="in">            // module1 on module2(base_temp)</span></span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a><span class="in">             subWord u_m1_after_m2 (</span></span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a><span class="in">                m2_out,</span></span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a><span class="in">                m1_after_m2_out</span></span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a><span class="in">            );</span></span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a><span class="in">            // module1 on base_temp</span></span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a><span class="in">            subWord u_m1_direct (</span></span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a><span class="in">                base_temp,</span></span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a><span class="in">                m1_direct_out</span></span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a><span class="in">            );</span></span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a><span class="in">            // Static (elaboration-time) conditions for this unrolled index i:</span></span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a><span class="in">            localparam bit COND_ROT   = ((i % NK) == 0);             // i mod Nk = 0</span></span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a><span class="in">            localparam bit COND_ONLY1 = ((NK &gt; 6) &amp;&amp; ((i % NK) == 4)); // Nk &gt; 6 and i mod Nk = 4</span></span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true" tabindex="-1"></a><span class="in">            // Select temp per pseudo-code:</span></span>
<span id="cb4-95"><a href="#cb4-95" aria-hidden="true" tabindex="-1"></a><span class="in">            // if (i % Nk == 0)              temp &lt;- module1(module2(temp)) XOR Rcon[i/Nk]</span></span>
<span id="cb4-96"><a href="#cb4-96" aria-hidden="true" tabindex="-1"></a><span class="in">            // else if (Nk &gt; 6 &amp;&amp; i%Nk == 4) temp &lt;- module1(temp)</span></span>
<span id="cb4-97"><a href="#cb4-97" aria-hidden="true" tabindex="-1"></a><span class="in">            // else                           temp &lt;- base_temp</span></span>
<span id="cb4-98"><a href="#cb4-98" aria-hidden="true" tabindex="-1"></a><span class="in">            wire [31:0] temp_selected = (COND_ROT)   ? (m1_after_m2_out ^ rcon[i / NK]) :</span></span>
<span id="cb4-99"><a href="#cb4-99" aria-hidden="true" tabindex="-1"></a><span class="in">                                        (COND_ONLY1) ?  m1_direct_out :</span></span>
<span id="cb4-100"><a href="#cb4-100" aria-hidden="true" tabindex="-1"></a><span class="in">                                                        base_temp;</span></span>
<span id="cb4-101"><a href="#cb4-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-102"><a href="#cb4-102" aria-hidden="true" tabindex="-1"></a><span class="in">            // w[i] &lt;- w[i-Nk] XOR temp</span></span>
<span id="cb4-103"><a href="#cb4-103" aria-hidden="true" tabindex="-1"></a><span class="in">            assign w_int[i] = w_int[i - NK] ^ temp_selected;</span></span>
<span id="cb4-104"><a href="#cb4-104" aria-hidden="true" tabindex="-1"></a><span class="in">        end</span></span>
<span id="cb4-105"><a href="#cb4-105" aria-hidden="true" tabindex="-1"></a><span class="in">    endgenerate</span></span>
<span id="cb4-106"><a href="#cb4-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-107"><a href="#cb4-107" aria-hidden="true" tabindex="-1"></a><span class="in">    // Drive outputs</span></span>
<span id="cb4-108"><a href="#cb4-108" aria-hidden="true" tabindex="-1"></a><span class="in">    genvar j;</span></span>
<span id="cb4-109"><a href="#cb4-109" aria-hidden="true" tabindex="-1"></a><span class="in">    generate</span></span>
<span id="cb4-110"><a href="#cb4-110" aria-hidden="true" tabindex="-1"></a><span class="in">        for (j = 0; j &lt; WORDS; j++) begin : OUTS</span></span>
<span id="cb4-111"><a href="#cb4-111" aria-hidden="true" tabindex="-1"></a><span class="in">            assign w[j] = w_int[j];</span></span>
<span id="cb4-112"><a href="#cb4-112" aria-hidden="true" tabindex="-1"></a><span class="in">        end</span></span>
<span id="cb4-113"><a href="#cb4-113" aria-hidden="true" tabindex="-1"></a><span class="in">    endgenerate</span></span>
<span id="cb4-114"><a href="#cb4-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-115"><a href="#cb4-115" aria-hidden="true" tabindex="-1"></a>endmodule</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="radiant-test" class="level4">
<h4 class="anchored" data-anchor-id="radiant-test">Radiant Test</h4>
<p>I fixed my testbench and made some code changes and ran the testbench but it did not pass the testbench. Below is a screenshot of the waveforms and the transcript.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/ai2.png" class="img-fluid figure-img"></p>
<figcaption>AI Prompt 2 Testbench Results</figcaption>
</figure>
</div>
</section>
</section>
<section id="reflection" class="level3">
<h3 class="anchored" data-anchor-id="reflection">Reflection</h3>
<p>For this lab, AI did not work too well. When using pseudocode by itself, ChatGPT was lost and produced very poor outputs. For the first prompt where we attached the NIST specification it had a lot more potential with the ride code tweaks and prompt changes, but ultimately was not where I wanted it to be. None of the code was able to pass testbenches, but continued prompting to tweak the code could have helped make it better and fix it. I was surprised that it did not work, maybe due to the complexity of the NIST FIPS-197 specification.</p>
</section>
</section>
<section id="hours-spent" class="level2">
<h2 class="anchored" data-anchor-id="hours-spent">Hours Spent</h2>
<p>I spent 20 hours on this lab.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/chrwu17\.github\.io\/hmc-e155-portfolio\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>